/*!
 * WxObserver.js v0.0.1
 * (c) 2014-2018 yyqqing
 * Released under the MIT License.
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.Vue={})}(this,function(t){"use strict";Object.freeze({});function e(t){return null!==t&&"object"==typeof t}var n=Object.prototype.toString;function r(t){return"[object Object]"===n.call(t)}function i(t,e){for(var n=Object.create(null),r=t.split(","),i=0;i<r.length;i++)n[r[i]]=!0;return e?function(t){return n[t.toLowerCase()]}:function(t){return n[t]}}i("slot,component",!0),i("key,ref,slot,slot-scope,is");function s(t,e){if(t.length){var n=t.indexOf(e);if(n>-1)return t.splice(n,1)}}var o=Object.prototype.hasOwnProperty;function a(t,e,n){}function c(t){var e=(t+"").charCodeAt(0);return 36===e||95===e}function h(t,e,n,r){Object.defineProperty(t,e,{value:n,enumerable:!!r,writable:!0,configurable:!0})}var u=/[^\w.$]/;var f,p="__proto__"in{},l=function(){return!1};function d(t){return"function"==typeof t&&/native code/.test(t.toString())}function v(t,e,n){console.log("handleError :: ",t,e,n)}f="undefined"!=typeof Set&&d(Set)?Set:function(){function t(){this.set=Object.create(null)}return t.prototype.has=function(t){return!0===this.set[t]},t.prototype.add=function(t){this.set[t]=!0},t.prototype.clear=function(){this.set=Object.create(null)},t}();var y,g,_=[],b=!1;function w(){b=!1;var t=_.slice(0);_.length=0;for(var e=0;e<t.length;e++)t[e]()}var m=!1;if("undefined"!=typeof setImmediate&&d(setImmediate))g=function(){setImmediate(w)};else if("undefined"==typeof MessageChannel||!d(MessageChannel)&&"[object MessageChannelConstructor]"!==MessageChannel.toString())g=function(){setTimeout(w,0)};else{var O=new MessageChannel,j=O.port2;O.port1.onmessage=w,g=function(){j.postMessage(1)}}if("undefined"!=typeof Promise&&d(Promise)){var D=Promise.resolve();y=function(){D.then(w)}}else y=g;var A=0,P=function(){this.id=A++,this.subs=[]};P.prototype.addSub=function(t){this.subs.push(t)},P.prototype.removeSub=function(t){s(this.subs,t)},P.prototype.depend=function(){P.target&&P.target.addDep(this)},P.prototype.notify=function(){for(var t=this.subs.slice(),e=0,n=t.length;e<n;e++)t[e].update()},P.target=null;var k=[];var x=Array.prototype,I=Object.create(x);["push","pop","shift","unshift","splice","sort","reverse"].forEach(function(t){var e=x[t];h(I,t,function(){for(var n=[],r=arguments.length;r--;)n[r]=arguments[r];var i,s=e.apply(this,n),o=this.__ob__;switch(t){case"push":case"unshift":i=n;break;case"splice":i=n.slice(2)}return i&&o.observeArray(i),o.dep.notify(),s})});var C=Object.getOwnPropertyNames(I),S={shouldConvert:!0},M=function(t){(this.value=t,this.dep=new P,this.vmCount=0,h(t,"__ob__",this),Array.isArray(t))?((p?z:E)(t,I,C),this.observeArray(t)):this.walk(t)};function z(t,e,n){t.__proto__=e}function E(t,e,n){for(var r=0,i=n.length;r<i;r++){var s=n[r];h(t,s,e[s])}}function W(t,n){var i,s,a;if(e(t))return s=t,a="__ob__",o.call(s,a)&&t.__ob__ instanceof M?i=t.__ob__:S.shouldConvert&&!l()&&(Array.isArray(t)||r(t))&&Object.isExtensible(t)&&!t._isVue&&(i=new M(t)),n&&i&&i.vmCount++,i}function V(t,e,n,r,i){var s=new P,o=Object.getOwnPropertyDescriptor(t,e);if(!o||!1!==o.configurable){var a=o&&o.get,c=o&&o.set,h=!i&&W(n);Object.defineProperty(t,e,{enumerable:!0,configurable:!0,get:function(){var e=a?a.call(t):n;return P.target&&(s.depend(),h&&(h.dep.depend(),Array.isArray(e)&&function t(e){for(var n=void 0,r=0,i=e.length;r<i;r++)(n=e[r])&&n.__ob__&&n.__ob__.dep.depend(),Array.isArray(n)&&t(n)}(e))),e},set:function(e){var r=a?a.call(t):n;e===r||e!=e&&r!=r||(c?c.call(t,e):n=e,h=!i&&W(e),s.notify())}})}}M.prototype.walk=function(t){for(var e=Object.keys(t),n=0;n<e.length;n++)V(t,e[n],t[e[n]])},M.prototype.observeArray=function(t){for(var e=0,n=t.length;e<n;e++)W(t[e])};var L=new f;function T(t){!function t(n,r){var i,s;var o=Array.isArray(n);if(!o&&!e(n)||Object.isFrozen(n))return;if(n.__ob__){var a=n.__ob__.dep.id;if(r.has(a))return;r.add(a)}if(o)for(i=n.length;i--;)t(n[i],r);else for(s=Object.keys(n),i=s.length;i--;)t(n[s[i]],r)}(t,L),L.clear()}var U=[],$=[],B={},F=!1,N=!1,q=0;function G(){var t,e;for(N=!0,U.sort(function(t,e){return t.id-e.id}),q=0;q<U.length;q++)e=(t=U[q]).id,B[e]=null,t.run();var n=$.slice(),r=U.slice();q=U.length=$.length=0,B={},F=N=!1,function(t){for(var e=0;e<t.length;e++)t[e]._inactive=!0,t[e]}(n),function(t){var e=t.length;for(;e--;){var n=t[e],r=n.vm;r._watcher===n&&r._isMounted}}(r)}function H(t){var e=t.id;if(null==B[e]){if(B[e]=!0,N){for(var n=U.length-1;n>q&&U[n].id>t.id;)n--;U.splice(n+1,0,t)}else U.push(t);F||(F=!0,function(t,e){var n;if(_.push(function(){if(t)try{t.call(e)}catch(t){v(t,e,"nextTick")}else n&&n(e)}),b||(b=!0,m?g():y()),!t&&"undefined"!=typeof Promise)new Promise(function(t){n=t})}(G))}}var J=0,K=function(t,e,n,r,i){this.vm=t,i&&(t._watcher=this),t._watchers.push(this),r?(this.deep=!!r.deep,this.user=!!r.user,this.lazy=!!r.lazy,this.sync=!!r.sync):this.deep=this.user=this.lazy=this.sync=!1,this.cb=n,this.id=++J,this.active=!0,this.dirty=this.lazy,this.deps=[],this.newDeps=[],this.depIds=new f,this.newDepIds=new f,this.expression=e.toString(),"function"==typeof e?this.getter=e:(this.getter=function(t){if(!u.test(t)){var e=t.split(".");return function(t){for(var n=0;n<e.length;n++){if(!t)return;t=t[e[n]]}return t}}}(e),this.getter||(this.getter=function(){})),this.value=this.lazy?void 0:this.get()};K.prototype.get=function(){var t,e;t=this,P.target&&k.push(P.target),P.target=t;var n=this.vm;try{e=this.getter.call(n,n)}catch(t){if(!this.user)throw t;v(t,n,'getter for watcher "'+this.expression+'"')}finally{this.deep&&T(e),P.target=k.pop(),this.cleanupDeps()}return e},K.prototype.addDep=function(t){var e=t.id;this.newDepIds.has(e)||(this.newDepIds.add(e),this.newDeps.push(t),this.depIds.has(e)||t.addSub(this))},K.prototype.cleanupDeps=function(){for(var t=this.deps.length;t--;){var e=this.deps[t];this.newDepIds.has(e.id)||e.removeSub(this)}var n=this.depIds;this.depIds=this.newDepIds,this.newDepIds=n,this.newDepIds.clear(),n=this.deps,this.deps=this.newDeps,this.newDeps=n,this.newDeps.length=0},K.prototype.update=function(){this.lazy?this.dirty=!0:this.sync?this.run():H(this)},K.prototype.run=function(){if(this.active){var t=this.get();if(t!==this.value||e(t)||this.deep){var n=this.value;if(this.value=t,this.user)try{this.cb.call(this.vm,this.expression,t,n)}catch(t){v(t,this.vm,'callback for watcher "'+this.expression+'"')}else this.cb.call(this.vm,this.expression,t,n)}}},K.prototype.evaluate=function(){this.value=this.get(),this.dirty=!1},K.prototype.depend=function(){for(var t=this.deps.length;t--;)this.deps[t].depend()},K.prototype.teardown=function(){if(this.active){this.vm._isBeingDestroyed||s(this.vm._watchers,this);for(var t=this.deps.length;t--;)this.deps[t].removeSub(this);this.active=!1}};var Q={enumerable:!0,configurable:!0,get:a,set:a},R={lazy:!0},X={};function Y(t,e,n){Q.get=function(){return this[e][n]},Q.set=function(t){this[e][n]=t},Object.defineProperty(t,n,Q)}function Z(t,e){Q.get=function(){var t=this._computedWatchers&&this._computedWatchers[e];if(t)return t.dirty&&t.evaluate(),P.target&&t.depend(),t.value},Object.defineProperty(t,e,Q)}var tt=function(t){var e,n=this;this._watchers=[],this._computedWatchers=Object.create(null),this._render=t._update;var i=this._data=t.props||{};console.log("VM.constructor 1 data = ",i),Object.keys(i).forEach(function(r){if(t.setData(((e={})[""+r]=i[r],e)),!c(r)){var s=Object.getOwnPropertyDescriptor(i,r);s.get?(X[r]=s,n._computedWatchers[r]=new K(n,s.get||a,a,R),Z(n,r)):Y(n,"_data",r)}}),W(i),console.log("VM.constructor 2 data = ",i),function t(e,n,i){if(void 0===i&&(i=""),Array.isArray(n))for(var s=0,o=n.length;s<o;s++)t(e,n[s],i+s+".");else for(var a=Object.keys(n),h=0,u=a.length;h<u;h++){var f=i+a[h];if(!c(f)){var p=X[a[h]];p&&p.get?(console.log("_watchComputed key : ",f,p),e._computedWatchers[f]=new K(e,p.get,e._renderDelegate,R),Z(e,f)):(console.log("_watchData key : ",f),new K(e,f,e._renderDelegate));var l=n[a[h]];(Array.isArray(l)||r(l))&&Object.isExtensible(l)&&t(e,l,f+".")}}}(this,i)};tt.prototype._renderDelegate=function(t,e,n){var r=t.replace(/\.(\d)\./g,"[$1].");this._render(r,e,n)},tt.prototype.teardown=function(){this._watchers.forEach(function(t){t.teardown()}),this._watchers=[],this._data={}};t.observe=function(t){var e=t.onLoad,n=t.onUnload;return t._update||(t._update=function(t,e,n){var r;console.warn("(@wx-observe default) : page._update = function(wxpath, newval, oldval)\n    path = ",t,"\n    newval = ",e,"\n    oldval = ",n),this.setData(((r={path:t,newval:e,oldval:n})[""+t]=e,r))}),t.onLoad=function(){this._vm=new tt(this),e&&e.apply(this,arguments)},t.onUnload=function(){this._vm&&this._vm.teardown(),n&&n.apply(this,arguments)},t},t.makeObservable=function(t){return new function(t){var e=this;this._watchers=[],this._computedWatchers=Object.create(null);var n=this._data=t||{};Object.keys(n).forEach(function(t){var r=Object.getOwnPropertyDescriptor(n,t);r.get?(e._computedWatchers[t]=new K(e,r.get||a,a,R),Z(e,t)):Y(e,"_data",t)}),W(this,!0)}(t)},Object.defineProperty(t,"__esModule",{value:!0})});