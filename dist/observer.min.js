/*!
 * WxObserver.js v0.0.1
 * (c) 2014-2018 yyqqing
 * Released under the MIT License.
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Vue=e()}(this,function(){"use strict";Object.freeze({});function t(t){return null!==t&&"object"==typeof t}var e=Object.prototype.toString;function n(t,e){for(var n=Object.create(null),i=t.split(","),r=0;r<i.length;r++)n[i[r]]=!0;return e?function(t){return n[t.toLowerCase()]}:function(t){return n[t]}}n("slot,component",!0),n("key,ref,slot,slot-scope,is");function i(t,e){if(t.length){var n=t.indexOf(e);if(n>-1)return t.splice(n,1)}}var r=Object.prototype.hasOwnProperty;var s=Function.prototype.bind?function(t,e){return t.bind(e)}:function(t,e){function n(n){var i=arguments.length;return i?i>1?t.apply(e,arguments):t.call(e,n):t.call(e)}return n._length=t.length,n};function o(t,e,n){}function a(t){var e=(t+"").charCodeAt(0);return 36===e||95===e}function h(t,e,n,i){Object.defineProperty(t,e,{value:n,enumerable:!!i,writable:!0,configurable:!0})}var c=/[^\w.$]/;var u,f="__proto__"in{},p=function(){return!1};function d(t){return"function"==typeof t&&/native code/.test(t.toString())}function l(t,e,n){console.log("handleError :: ",t,e,n)}u="undefined"!=typeof Set&&d(Set)?Set:function(){function t(){this.set=Object.create(null)}return t.prototype.has=function(t){return!0===this.set[t]},t.prototype.add=function(t){this.set[t]=!0},t.prototype.clear=function(){this.set=Object.create(null)},t}();var v,y,g=[],_=!1;function b(){_=!1;var t=g.slice(0);g.length=0;for(var e=0;e<t.length;e++)t[e]()}var m=!1;if("undefined"!=typeof setImmediate&&d(setImmediate))y=function(){setImmediate(b)};else if("undefined"==typeof MessageChannel||!d(MessageChannel)&&"[object MessageChannelConstructor]"!==MessageChannel.toString())y=function(){setTimeout(b,0)};else{var w=new MessageChannel,j=w.port2;w.port1.onmessage=b,y=function(){j.postMessage(1)}}if("undefined"!=typeof Promise&&d(Promise)){var O=Promise.resolve();v=function(){O.then(b)}}else v=y;var D=0,A=function(){this.id=D++,this.subs=[]};A.prototype.addSub=function(t){this.subs.push(t)},A.prototype.removeSub=function(t){i(this.subs,t)},A.prototype.depend=function(){A.target&&A.target.addDep(this)},A.prototype.notify=function(){for(var t=this.subs.slice(),e=0,n=t.length;e<n;e++)t[e].update()},A.target=null;var I=[];var k=Array.prototype,C=Object.create(k);["push","pop","shift","unshift","splice","sort","reverse"].forEach(function(t){var e=k[t];h(C,t,function(){for(var n=[],i=arguments.length;i--;)n[i]=arguments[i];var r,s=e.apply(this,n),o=this.__ob__;switch(t){case"push":case"unshift":r=n;break;case"splice":r=n.slice(2)}return r&&o.observeArray(r),o.dep.notify(),s})});var P=Object.getOwnPropertyNames(C),S=!0;var x=function(t){(this.value=t,this.dep=new A,this.vmCount=0,h(t,"__ob__",this),Array.isArray(t))?((f?M:E)(t,C,P),this.observeArray(t)):this.walk(t)};function M(t,e,n){t.__proto__=e}function E(t,e,n){for(var i=0,r=n.length;i<r;i++){var s=n[i];h(t,s,e[s])}}function F(n,i){var s,o,a,h;if(t(n))return a=n,h="__ob__",r.call(a,h)&&n.__ob__ instanceof x?s=n.__ob__:!S||p()||!Array.isArray(n)&&(o=n,"[object Object]"!==e.call(o))||!Object.isExtensible(n)||n._isVue||(s=new x(n)),i&&s&&s.vmCount++,s}function L(t,e,n,i,r){var s=new A,o=Object.getOwnPropertyDescriptor(t,e);if(!o||!1!==o.configurable){var a=o&&o.get,h=o&&o.set;a&&!h||2!==arguments.length||(n=t[e]);var c=!r&&F(n);Object.defineProperty(t,e,{enumerable:!0,configurable:!0,get:function(){var e=a?a.call(t):n;return A.target&&(s.depend(),c&&(c.dep.depend(),Array.isArray(e)&&function t(e){for(var n=void 0,i=0,r=e.length;i<r;i++)(n=e[i])&&n.__ob__&&n.__ob__.dep.depend(),Array.isArray(n)&&t(n)}(e))),e},set:function(e){var i=a?a.call(t):n;e===i||e!=e&&i!=i||(h?h.call(t,e):n=e,c=!r&&F(e),s.notify())}})}}x.prototype.walk=function(t){for(var e=Object.keys(t),n=0;n<e.length;n++)L(t,e[n])},x.prototype.observeArray=function(t){for(var e=0,n=t.length;e<n;e++)F(t[e])};var T=new u;function V(e){!function e(n,i){var r,s;var o=Array.isArray(n);if(!o&&!t(n)||Object.isFrozen(n))return;if(n.__ob__){var a=n.__ob__.dep.id;if(i.has(a))return;i.add(a)}if(o)for(r=n.length;r--;)e(n[r],i);else for(s=Object.keys(n),r=s.length;r--;)e(n[s[r]],i)}(e,T),T.clear()}var z=[],U=[],W={},B=!1,N=!1,$=0;function q(){var t,e;for(N=!0,z.sort(function(t,e){return t.id-e.id}),$=0;$<z.length;$++)(t=z[$]).before&&t.before(),e=t.id,W[e]=null,t.run();var n=U.slice(),i=z.slice();$=z.length=U.length=0,W={},B=N=!1,function(t){for(var e=0;e<t.length;e++)t[e]._inactive=!0,t[e]}(n),function(t){var e=t.length;for(;e--;){var n=t[e],i=n.vm;i._watcher===n&&i._isMounted}}(i)}function G(t){var e=t.id;if(null==W[e]){if(W[e]=!0,N){for(var n=z.length-1;n>$&&z[n].id>t.id;)n--;z.splice(n+1,0,t)}else z.push(t);B||(B=!0,function(t,e){var n;if(g.push(function(){if(t)try{t.call(e)}catch(t){l(t,e,"nextTick")}else n&&n(e)}),_||(_=!0,m?y():v()),!t&&"undefined"!=typeof Promise)new Promise(function(t){n=t})}(q))}}var H=0,J=function(t,e,n,i,r){this.vm=t,r&&(t._watcher=this),t._watchers.push(this),i?(this.deep=!!i.deep,this.user=!!i.user,this.computed=!!i.computed,this.sync=!!i.sync,this.before=i.before):this.deep=this.user=this.computed=this.sync=!1,this.cb=n,this.id=++H,this.active=!0,this.dirty=this.computed,this.deps=[],this.newDeps=[],this.depIds=new u,this.newDepIds=new u,this.expression="","function"==typeof e?this.getter=e:(this.getter=function(t){if(!c.test(t)){var e=t.split(".");return function(t){for(var n=0;n<e.length;n++){if(!t)return;t=t[e[n]]}return t}}}(e),this.getter||(this.getter=function(){})),this.computed?(this.value=void 0,this.dep=new A):this.value=this.get()};J.prototype.get=function(){var t,e;t=this,A.target&&I.push(A.target),A.target=t;var n=this.vm;try{e=this.getter.call(n,n)}catch(t){if(!this.user)throw t;l(t,n,'getter for watcher "'+this.expression+'"')}finally{this.deep&&V(e),A.target=I.pop(),this.cleanupDeps()}return e},J.prototype.addDep=function(t){var e=t.id;this.newDepIds.has(e)||(this.newDepIds.add(e),this.newDeps.push(t),this.depIds.has(e)||t.addSub(this))},J.prototype.cleanupDeps=function(){for(var t=this.deps.length;t--;){var e=this.deps[t];this.newDepIds.has(e.id)||e.removeSub(this)}var n=this.depIds;this.depIds=this.newDepIds,this.newDepIds=n,this.newDepIds.clear(),n=this.deps,this.deps=this.newDeps,this.newDeps=n,this.newDeps.length=0},J.prototype.update=function(){var t=this;this.computed?0===this.dep.subs.length?this.dirty=!0:this.getAndInvoke(function(){t.dep.notify()}):this.sync?this.run():G(this)},J.prototype.run=function(){this.active&&this.getAndInvoke(this.cb)},J.prototype.getAndInvoke=function(e){var n=this.get();if(n!==this.value||t(n)||this.deep){var i=this.value;if(this.value=n,this.dirty=!1,this.user)try{e.call(this.vm,n,i)}catch(t){l(t,this.vm,'callback for watcher "'+this.expression+'"')}else e.call(this.vm,n,i)}},J.prototype.evaluate=function(){return this.dirty&&(this.value=this.get(),this.dirty=!1),this.value},J.prototype.depend=function(){this.dep&&A.target&&this.dep.depend()},J.prototype.teardown=function(){if(this.active){this.vm._isBeingDestroyed||i(this.vm._watchers,this);for(var t=this.deps.length;t--;)this.deps[t].removeSub(this);this.active=!1}};var K={enumerable:!0,configurable:!0,get:o,set:o},Q={computed:!0};function R(t,e,n){"function"==typeof n?(K.get=n,K.set=o):(K.get=n.get?n.get:o,K.set=n.set?n.set:o),K.set===o&&(K.set=function(){console.log('Computed property "'+e+'" was assigned to but it has no setter.')}),Object.defineProperty(t,e,K)}var X=function(t){this._watchers=[];var e=this;S=!0;var n=e._data=t.data||{};Object.keys(n).forEach(function(t){var n,i,r;a(t)||(n=e,i="_data",r=t,K.get=function(){return this[i][r]},K.set=function(t){this[i][r]=t},Object.defineProperty(n,r,K))}),F(n,!0);var i=t.computed,r=e._computedWatchers=Object.create(null);for(var h in i){var c=i[h],u="function"==typeof c?c:c.get;r[h]=new J(e,u||o,o,Q),h in e?console.log('The computed property "'+h+'" is already defined in data.'):R(e,h,c)}var f=t.methods;for(var p in f)e[p]=null==f[p]?o:s(f[p],e)};X.prototype.allData=function(){var t=this,e={};return Object.keys(this).forEach(function(n){a(n)||(e[n]=t[n])}),e},X.prototype.teardown=function(){this._watcher&&this._watcher.teardown(),this._watchers.forEach(function(t){t.teardown()}),this._data={},this._watchers=[],this._computedWatchers={}};return{observe:function(t){var e=t.onLoad,n=t.onUnload;return t.onLoad=function(){var t=this;this.model&&(this.model=this._vm=new X(this.model),new J(this._vm,function(){t.setData(t._vm.allData())},o,{},!0)),e&&e.apply(this,arguments)},t.onUnload=function(){this._vm&&this._vm.teardown(),n&&n.apply(this,arguments)},t},observable:function(t){return new X(t)},set:function(t,e,n){if(Array.isArray(t)&&(i=e,(r=parseFloat(String(i)))>=0&&Math.floor(r)===r&&isFinite(i)))return t.length=Math.max(t.length,e),t.splice(e,1,n),n;var i,r;if(e in t&&!(e in Object.prototype))return t[e]=n,n;var s=t.__ob__;return t._isVue||s&&s.vmCount?n:s?(L(s.value,e,n),s.dep.notify(),n):(t[e]=n,n)}}});