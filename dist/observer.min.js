/*!
 * WxObserver.js v0.0.1
 * (c) 2014-2018 yyqqing
 * Released under the MIT License.
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Vue=e()}(this,function(){"use strict";Object.freeze({});function a(t){return null!==t&&"object"==typeof t}var o=Object.prototype.toString;function t(t,e){for(var n=Object.create(null),i=t.split(","),r=0;r<i.length;r++)n[i[r]]=!0;return e?function(t){return n[t.toLowerCase()]}:function(t){return n[t]}}t("slot,component",!0),t("key,ref,slot,slot-scope,is");function e(t,e){if(t.length){var n=t.indexOf(e);if(-1<n)return t.splice(n,1)}}var h=Object.prototype.hasOwnProperty;var u=Function.prototype.bind?function(t,e){return t.bind(e)}:function(n,i){function t(t){var e=arguments.length;return e?1<e?n.apply(i,arguments):n.call(i,t):n.call(i)}return t._length=n.length,t};function f(t,e,n){}function p(t){var e=(t+"").charCodeAt(0);return 36===e||95===e}function c(t,e,n,i){Object.defineProperty(t,e,{value:n,enumerable:!!i,writable:!0,configurable:!0})}var s=/[^\w.$]/;var d,n="__proto__"in{},l=function(){return!1};function i(t){return"function"==typeof t&&/native code/.test(t.toString())}function r(t,e,n){console.log("handleError :: ",t,e,n)}d="undefined"!=typeof Set&&i(Set)?Set:function(){function t(){this.set=Object.create(null)}return t.prototype.has=function(t){return!0===this.set[t]},t.prototype.add=function(t){this.set[t]=!0},t.prototype.clear=function(){this.set=Object.create(null)},t}();var v,y,g=[],_=!1;function b(){_=!1;for(var t=g.slice(0),e=g.length=0;e<t.length;e++)t[e]()}var m=!1;if("undefined"!=typeof setImmediate&&i(setImmediate))y=function(){setImmediate(b)};else if("undefined"==typeof MessageChannel||!i(MessageChannel)&&"[object MessageChannelConstructor]"!==MessageChannel.toString())y=function(){setTimeout(b,0)};else{var w=new MessageChannel,j=w.port2;w.port1.onmessage=b,y=function(){j.postMessage(1)}}if("undefined"!=typeof Promise&&i(Promise)){var O=Promise.resolve();v=function(){O.then(b)}}else v=y;var D=0,A=function(){this.id=D++,this.subs=[]};A.prototype.addSub=function(t){this.subs.push(t)},A.prototype.removeSub=function(t){e(this.subs,t)},A.prototype.depend=function(){A.target&&A.target.addDep(this)},A.prototype.notify=function(){for(var t=this.subs.slice(),e=0,n=t.length;e<n;e++)t[e].update()},A.target=null;var I=[];var k=Array.prototype,C=Object.create(k);["push","pop","shift","unshift","splice","sort","reverse"].forEach(function(s){var o=k[s];c(C,s,function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var n,i=o.apply(this,t),r=this.__ob__;switch(s){case"push":case"unshift":n=t;break;case"splice":n=t.slice(2)}return n&&r.observeArray(n),r.dep.notify(),i})});var P=Object.getOwnPropertyNames(C),S=!0;var x=function(t){(this.value=t,this.dep=new A,this.vmCount=0,c(t,"__ob__",this),Array.isArray(t))?((n?M:E)(t,C,P),this.observeArray(t)):this.walk(t)};function M(t,e,n){t.__proto__=e}function E(t,e,n){for(var i=0,r=n.length;i<r;i++){var s=n[i];c(t,s,e[s])}}function F(t,e){var n,i,r,s;if(a(t))return r=t,s="__ob__",h.call(r,s)&&t.__ob__ instanceof x?n=t.__ob__:!S||l()||!Array.isArray(t)&&(i=t,"[object Object]"!==o.call(i))||!Object.isExtensible(t)||t._isVue||(n=new x(t)),e&&n&&n.vmCount++,n}function L(n,t,i,e,r){var s=new A,o=Object.getOwnPropertyDescriptor(n,t);if(!o||!1!==o.configurable){var a=o&&o.get,h=o&&o.set;a&&!h||2!==arguments.length||(i=n[t]);var c=!r&&F(i);Object.defineProperty(n,t,{enumerable:!0,configurable:!0,get:function(){var t=a?a.call(n):i;return A.target&&(s.depend(),c&&(c.dep.depend(),Array.isArray(t)&&function t(e){for(var n=void 0,i=0,r=e.length;i<r;i++)(n=e[i])&&n.__ob__&&n.__ob__.dep.depend(),Array.isArray(n)&&t(n)}(t))),t},set:function(t){var e=a?a.call(n):i;t===e||t!=t&&e!=e||(h?h.call(n,t):i=t,c=!r&&F(t),s.notify())}})}}x.prototype.walk=function(t){for(var e=Object.keys(t),n=0;n<e.length;n++)L(t,e[n])},x.prototype.observeArray=function(t){for(var e=0,n=t.length;e<n;e++)F(t[e])};var T=new d;function V(t){!function t(e,n){var i,r;var s=Array.isArray(e);if(!s&&!a(e)||Object.isFrozen(e))return;if(e.__ob__){var o=e.__ob__.dep.id;if(n.has(o))return;n.add(o)}if(s)for(i=e.length;i--;)t(e[i],n);else for(r=Object.keys(e),i=r.length;i--;)t(e[r[i]],n)}(t,T),T.clear()}var z=[],U=[],W={},B=!1,N=!1,$=0;function q(){var t,e;for(N=!0,z.sort(function(t,e){return t.id-e.id}),$=0;$<z.length;$++)(t=z[$]).before&&t.before(),e=t.id,W[e]=null,t.run();var n=U.slice(),i=z.slice();$=z.length=U.length=0,B=N=!(W={}),function(t){for(var e=0;e<t.length;e++)t[e]._inactive=!0,t[e]}(n),function(t){var e=t.length;for(;e--;){var n=t[e],i=n.vm;i._watcher===n&&i._isMounted}}(i)}function G(t){var e=t.id;if(null==W[e]){if(W[e]=!0,N){for(var n=z.length-1;$<n&&z[n].id>t.id;)n--;z.splice(n+1,0,t)}else z.push(t);B||(B=!0,function(t,e){var n;if(g.push(function(){if(t)try{t.call(e)}catch(t){r(t,e,"nextTick")}else n&&n(e)}),_||(_=!0,m?y():v()),!t&&"undefined"!=typeof Promise)new Promise(function(t){n=t})}(q))}}var H=0,J=function(t,e,n,i,r){this.vm=t,r&&(t._watcher=this),t._watchers.push(this),i?(this.deep=!!i.deep,this.user=!!i.user,this.computed=!!i.computed,this.sync=!!i.sync,this.before=i.before):this.deep=this.user=this.computed=this.sync=!1,this.cb=n,this.id=++H,this.active=!0,this.dirty=this.computed,this.deps=[],this.newDeps=[],this.depIds=new d,this.newDepIds=new d,this.expression="","function"==typeof e?this.getter=e:(this.getter=function(t){if(!s.test(t)){var n=t.split(".");return function(t){for(var e=0;e<n.length;e++){if(!t)return;t=t[n[e]]}return t}}}(e),this.getter||(this.getter=function(){})),this.computed?(this.value=void 0,this.dep=new A):this.value=this.get()};J.prototype.get=function(){var t,e;t=this,A.target&&I.push(A.target),A.target=t;var n=this.vm;try{e=this.getter.call(n,n)}catch(t){if(!this.user)throw t;r(t,n,'getter for watcher "'+this.expression+'"')}finally{this.deep&&V(e),A.target=I.pop(),this.cleanupDeps()}return e},J.prototype.addDep=function(t){var e=t.id;this.newDepIds.has(e)||(this.newDepIds.add(e),this.newDeps.push(t),this.depIds.has(e)||t.addSub(this))},J.prototype.cleanupDeps=function(){for(var t=this.deps.length;t--;){var e=this.deps[t];this.newDepIds.has(e.id)||e.removeSub(this)}var n=this.depIds;this.depIds=this.newDepIds,this.newDepIds=n,this.newDepIds.clear(),n=this.deps,this.deps=this.newDeps,this.newDeps=n,this.newDeps.length=0},J.prototype.update=function(){var t=this;this.computed?0===this.dep.subs.length?this.dirty=!0:this.getAndInvoke(function(){t.dep.notify()}):this.sync?this.run():G(this)},J.prototype.run=function(){this.active&&this.getAndInvoke(this.cb)},J.prototype.getAndInvoke=function(t){var e=this.get();if(e!==this.value||a(e)||this.deep){var n=this.value;if(this.value=e,this.dirty=!1,this.user)try{t.call(this.vm,e,n)}catch(t){r(t,this.vm,'callback for watcher "'+this.expression+'"')}else t.call(this.vm,e,n)}},J.prototype.evaluate=function(){return this.dirty&&(this.value=this.get(),this.dirty=!1),this.value},J.prototype.depend=function(){this.dep&&A.target&&this.dep.depend()},J.prototype.teardown=function(){if(this.active){this.vm._isBeingDestroyed||e(this.vm._watchers,this);for(var t=this.deps.length;t--;)this.deps[t].removeSub(this);this.active=!1}};var K={enumerable:!0,configurable:!0,get:f,set:f},Q={computed:!0};function R(t,e,n){K.set="function"==typeof n?(K.get=n,f):(K.get=n.get?n.get:f,n.set?n.set:f),K.set===f&&(K.set=function(){console.log('Computed property "'+e+'" was assigned to but it has no setter.')}),Object.defineProperty(t,e,K)}var X=function(t){this._watchers=[];var r=this;S=!0;var e=r._data=t.data||{};Object.keys(e).forEach(function(t){var e,n,i;p(t)||(e=r,n="_data",i=t,K.get=function(){return this[n][i]},K.set=function(t){this[n][i]=t},Object.defineProperty(e,i,K))}),F(e,!0);var n=t.computed,i=r._computedWatchers=Object.create(null);for(var s in n){var o=n[s],a="function"==typeof o?o:o.get;i[s]=new J(r,a||f,f,Q),s in r?console.log('The computed property "'+s+'" is already defined in data.'):R(r,s,o)}var h=t.methods;for(var c in h)r[c]=null==h[c]?f:u(h[c],r)};X.prototype.allData=function(){var e=this,n={};return Object.keys(this).forEach(function(t){p(t)||(n[t]=e[t])}),n},X.prototype.teardown=function(){this._watcher&&this._watcher.teardown(),this._watchers.forEach(function(t){t.teardown()}),this._data={},this._watchers=[],this._computedWatchers={}};return{observe:function(t){var e=t.onLoad,n=t.onUnload;return t.onLoad=function(){var t=this;this.model&&(this.model=this._vm=new X(this.model),new J(this._vm,function(){t.setData(t._vm.allData())},f,{},!0)),e&&e.apply(this,arguments)},t.onUnload=function(){this._vm&&this._vm.teardown(),n&&n.apply(this,arguments)},t},observable:function(t){return new X(t)},set:function(t,e,n){if(Array.isArray(t)&&(i=e,0<=(r=parseFloat(String(i)))&&Math.floor(r)===r&&isFinite(i)))return t.length=Math.max(t.length,e),t.splice(e,1,n),n;var i,r;if(e in t&&!(e in Object.prototype))return t[e]=n;var s=t.__ob__;return t._isVue||s&&s.vmCount?n:s?(L(s.value,e,n),s.dep.notify(),n):t[e]=n}}});